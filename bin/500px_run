#! /usr/bin/env node
'use strict';

if (!process.env.IS_PROD) require('dotenv').load();

const handleError = require('../lib/error');
const fivehundredpix = require('../lib/500px');
const cache = require('../lib/cache').cache;
const upload = require('../lib/upload');
const invalidate = require('../lib/invalidate');

fivehundredpix((error, results) => {
  if (error) {
    handleError(error);
    process.exit();
  } else {
    cache(results, (error) => {
      if (error) {
        handleError(error);
      } else {
        upload((error) => {
          if (error) {
            handleError(error);
          } else {
            invalidate(() => {
              console.log('Process complete');
              process.exit();
            });
          }
        });
      }
    });
  }
});
